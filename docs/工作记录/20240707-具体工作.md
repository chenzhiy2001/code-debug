### 移植调试器到xv6
#### 具体工作
1. 将调试器仅rust语言可见改为所有语言均可（适配c语言）
2. 找到内核出口、用户出口、获取下一进程的函数的位置并设置断点
  + 用户出口：syscall.c 137
  + 内核出口：trap.c 127
  + 钩子断点：sysfile.c 441
    
#### 遇到的问题：
1. 调试到最后会在内核出口与用户出口来回跳转，不会回到调试文件设置断点处
2. 调试器可能会断开连接，需要多次连接

### launch.json
{
    "version": "0.2.0",
    "configurations": [
        
        {
            "type": "gdb",
            "request": "attach",
            "name": "Attach to Qemu",
            "autorun": ["add-symbol-file ${workspaceFolder}/kernel/kernel"],
            "target": ":1234",
            "remote": true,
            "cwd": "/home/kaining/xv6-riscv",
            "valuesFormatting": "parseText",
            "gdbpath": "${workspaceFolder}/riscv64-unknown-elf-gdb-rust.sh",
            "showDevDebugOutput":true,
            "internalConsoleOptions": "openOnSessionStart",
            "printCalls": true,
            "stopAtConnect": true,
            "qemuPath": "${workspaceFolder}/qemu-system-riscv64-with-logs.sh",
            "qemuArgs": [
                "-machine",
                "virt",
                "-bios",
                "none",
                "-kernel",
                "kernel/kernel",
                "-m",
                "128M",
                "-smp",
                "2", 
                "-nographic",
                "-global",
                "virtio-mmio.force-legacy=false",
                "-drive",
                "file=fs.img,if=none,format=raw,id=x0",
                "-device",
                "virtio-blk-device,drive=x0,bus=virtio-mmio-bus.0",
                
                "-device",
                "virtio-gpu-device",
                "-device",
                "virtio-keyboard-device",
                "-device",
                "virtio-mouse-device",
                
                "-serial",
                "pty",
                "-s",
                "-S"
            ],
            "program_counter_id": 32,
            "first_breakpoint_group": "kernel",
            "second_breakpoint_group":"${workspaceFolder}/user/init.c",
            "kernel_memory_ranges":[["0x80000000","0xffffffffffffffff"]],
            "user_memory_ranges":[["0x0000000000000000","0x80000000"]],
            "border_breakpoints":[
                {
                    "filepath": "${workspaceFolder}/kernel/syscall.c",
                    "line": 141
                },
                {
                    "filepath": "${workspaceFolder}/kernel/trap.c",
                    "line": 105
                }
            ],
            "hook_breakpoints":[
                {
                    "breakpoint": {
                        "file": "${workspaceFolder}/kernel/sysfile.c",
                        "line": 441
                    },
                    "behavior": {
                        "isAsync": true,
                        "functionArguments": "",
                        "functionBody": "let p=await this.getStringVariable('path'); return '${workspaceFolder}/user/'+p+'.c'"
                    }
                }
            ],
            "filePathToBreakpointGroupNames":{
                "isAsync": false,
                "functionArguments": "filePathStr",
                "functionBody": "     if (filePathStr.includes('kernel')) {        return ['kernel'];    }    else if (filePathStr.includes('user')) {        return [filePathStr];    }    else        return ['kernel'];"
            },
            "breakpointGroupNameToDebugFilePath":{
                "isAsync": false,
                "functionArguments": "groupName",
                "functionBody": "if (groupName === 'kernel') {return '${workspaceFolder}/kernel';}  else{ let pathSplited = groupName.split('/'); let filename = pathSplited[pathSplited.length - 1].split('.'); let filenameWithoutExtension = filename.slice(0, -1).join('.'); return '${workspaceFolder}/user/' + filenameWithoutExtension;}"
                
            }
        },
    ],
}
